// Imports
const { Storage } = require('@google-cloud/storage');

// Get a handle on benign and malicious buckets
const storage = new Storage();
const maliciousBucket = storage.bucket('malicious-pdf-files');
const benignBucket = storage.bucket('benign-pdf-files');

// Entry Function
exports.fileCounts = async (req, res) => {
    // Retrieve the files in each bucket in the form of an array
    try {
        const [maliciousFiles] = await maliciousBucket.getFiles();
        const [benignFiles] = await benignBucket.getFiles();

        // Log the length 
        console.log(`Malicious Files: ${maliciousFiles.length}`);
        console.log(`Benign Files: ${benignFiles.length}`);

        // Report out the amount of malicous and benign files
        res.status(200).send(`Malicious Files: ${maliciousFiles.length}, Benign Files: ${benignFiles.length}`);
    } catch (error) {
        // Report error if necessary
        console.error(error);
        res.status(500).send('Error retrieving file counts.');
    }
};
